#!/bin/bash
# A.R.B. Configuration File
# ENVIRONMENT
config="$HOME/config/arb"

# System
system_repo="$HOME/.archive/system"         # system repository
system_exclude="audisp brlapi.key ca-certificates crypttab default/useradd gshadow* iptables libaudit.conf mtab NetworkManager/system-connections pacman.d/gnupg polkit-1 .pwd.lock shadow* sudoers sudoers.d ufw"              # system exclude list

# Home
home_repo="$HOME/.archive/home"                     # borg repository
home_exclude="$config/home.ignore"           # borg exclude file
home_pass="home"                            # gocryptfs password
home_rsync="/mnt/backup/name"               # rsync destination dir
home_rclone=(nextcloud onedrive amazons3)   # rclone destination streams

# TASKS
# System Archive
archiveSys -o "$system_repo" -e "$system_exclude" & child=$! && wait $child

# Borg Archive
archiveBorg -n "home" -i "$HOME" -o "$home_repo" -e "$home_exclude" & child=$! && wait $child

# Repo Sync to Disk
syncDisk -n "home" -i "$home_repo" -o "$home_rsync" & child=$! && wait $child

# Repo Sync to Cloud
mountCrypt -n "home" -i "$home_repo" -p "$home_pass" || exit 1
syncCloud -n "home" -s "$home_rclone" & child=$! && wait $child
umountCrypt -n "home"

# TODO: Is it possible to move child PID parsing and wait to main?
